<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Generador de Cartones de Bingo Argentino</title>
    <meta name="viewport" content="width=800">
    <style>
        @font-face {
            font-family: 'Nunito';
            font-weight: 400;
            src: url('Nunito-Regular.ttf') format('truetype');
        }
        @font-face {
            font-family: 'Nunito';
            font-weight: 600;
            src: url('Nunito-SemiBold.ttf') format('truetype');
        }
        @font-face {
            font-family: 'Nunito';
            font-weight: 700;
            src: url('Nunito-Bold.ttf') format('truetype');
        }
        @font-face {
            font-family: 'Nunito';
            font-weight: 800;
            src: url('Nunito-ExtraBold.ttf') format('truetype');
        }
        :root {
            --bg-light: #e6f3ff;
            --bg-dark: #1a365d;
            --card-light: #fff;
            --card-dark: #2c3440;
            --border-light: #ddd;
            --border-dark: #444;
            --cell-light: #fff;
            --cell-dark: #23272f;
            --cell-mark-light: #fff3cd;
            --cell-mark-dark: #d4a017;
            --text-light: #1a365d;
            --text-dark: #e6f3ff;
            --accent: #1a365d;
            --line-win: #4caf50;
            --bingo-win: #e91e63;
        }
        html {
            font-size: 16px;
        }
        body {
            margin: 0;
            font-family: 'Nunito', 'Segoe UI', Arial, sans-serif;
            background: var(--bg-light);
            color: var(--text-light);
            transition: background 0.3s, color 0.3s;
        }
        body.dark {
            background: var(--bg-dark);
            color: var(--text-dark);
        }
        header {
            text-align: center;
            margin-top: 40px;
            margin-bottom: 30px;
        }
        header h1 {
            font-family: 'Nunito', sans-serif;
            font-weight: 800;
            font-size: 3.2rem;
            color: var(--accent);
            margin: 0;
            line-height: 1.5;
        }
        body.dark header h1 {
            color: var(--text-dark);
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-bottom: 50px;
            flex-wrap: wrap;
        }
        .controls button {
            font-family: 'Nunito', sans-serif;
            font-weight: 600;
            font-size: 1.1rem;
            padding: 12px 24px;
            border-radius: 25px;
            border: 1px solid transparent;
            background: #fff;
            color: var(--accent);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 4px 4px 0 rgba(0,0,0,0.2);
        }
        .controls button:hover {
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 rgba(0,0,0,0.25);
        }
        body.dark .controls button {
            background: var(--card-dark);
            color: var(--text-dark);
            border: 1px solid var(--border-dark);
        }
        
        /* Toggle Switch Styles */
        .toggle-container {
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'Nunito', sans-serif;
            font-weight: 600;
            color: var(--accent);
            min-width: 100px;
        }
        .toggle-container span {
            min-width: 50px;
            text-align: center;
        }
        body.dark .toggle-container {
            color: var(--text-dark);
        }
        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: #ccc;
            border-radius: 15px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .toggle-switch.active {
            background: var(--accent);
        }
        body.dark .toggle-switch {
            background: #ccc;
        }
        body.dark .toggle-switch.active {
            background: var(--text-dark);
        }
        .toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .toggle-switch.active .toggle-slider {
            transform: translateX(30px);
        }
        main {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 60vh;
        }
        .bingo-list {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 32px;
            width: 100%;
            margin-bottom: 32px;
            max-height: 80vh;
            overflow-y: auto;
        }
        .bingo-card {
            background: #fff;
            border: 2px solid var(--border-light);
            border-radius: 20px;
            box-shadow: 6px 6px 0 rgba(0,0,0,0.2);
            width: 720px;
            height: 240px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            transition: all 0.3s ease;
        }
        body.dark .bingo-card {
            background: var(--card-dark);
            border: 2px solid var(--border-dark);
        }
        .bingo-card .status {
            position: absolute;
            top: 50%;
            right: -140px;
            transform: translateY(-50%);
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--accent);
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 2px;
        }
        .bingo-card .status .line {
            color: var(--accent);
        }
        .bingo-card .status .bingo {
            color: var(--accent);
            font-size: 1.2rem;
        }
        body.dark .bingo-card .status .line {
            color: var(--text-dark);
        }
        body.dark .bingo-card .status .bingo {
            color: var(--text-dark);
        }
        .bingo-grid {
            display: grid;
            grid-template-columns: repeat(9, 80px);
            grid-template-rows: repeat(3, 80px);
            gap: 0;
            width: 720px;
            height: 240px;
            border-radius: 20px;
            overflow: hidden;
            background: transparent;
        }
        .bingo-cell {
            width: 78px;
            height: 78px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Nunito', sans-serif;
            font-size: 2.1rem;
            font-weight: 600;
            border: 1px solid #ddd;
            background: #fff;
            color: var(--accent);
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease;
        }
        body.dark .bingo-cell {
            background: var(--cell-dark);
            color: var(--text-dark);
            border: 1px solid var(--border-dark);
        }
        .bingo-cell.marked {
            background: #fff3cd;
            color: var(--accent);
            border: 1px solid #ddd;
        }
        body.dark .bingo-cell.marked {
            background: #fff3cd;
            color: var(--cell-dark);
            border: 1px solid var(--border-dark);
        }
        .bingo-cell.empty {
            background: transparent;
            border: 1px solid #ddd;
            cursor: default;
        }
        body.dark .bingo-cell.empty {
            border: 1px solid var(--border-dark);
        }
        /* Responsive */
        @media (max-width: 800px) {
            .bingo-card, .bingo-grid {
                width: 98vw;
                min-width: 320px;
                max-width: 99vw;
                height: auto;
            }
            .bingo-grid {
                grid-template-columns: repeat(9, 1fr);
                grid-template-rows: repeat(3, 1fr);
            }
            .bingo-cell {
                width: 100%;
                height: 80px;
                font-size: 1.7rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Bingo Argentino</h1>
    </header>
    <section class="controls">
        <button id="newCardBtn">Nuevo cartón</button>
        <button id="clearBtn">Borrar todo</button>
        <div class="toggle-container">
            <div class="toggle-switch" id="themeToggle">
                <div class="toggle-slider"></div>
            </div>
            <span id="themeLabel">Claro</span>
        </div>
    </section>
    <main>
        <div class="bingo-list" id="bingoList"></div>
    </main>
    <script>
        // --- Estado global ---
        const bingoCards = [];

        // --- Local Storage Handler ---
        document.addEventListener('DOMContentLoaded', () => {
            // Load theme
            const savedTheme = localStorage.getItem('bingoTheme');
            if (savedTheme) {
                if (savedTheme === 'dark') {
                    document.body.classList.add('dark');
                    document.getElementById('themeToggle').classList.add('active');
                    document.getElementById('themeLabel').textContent = 'Oscuro';
                }
            }
            
            // Load cards
            const savedCards = localStorage.getItem('bingoCards');
            if (savedCards) {
                bingoCards.push(...JSON.parse(savedCards));
                renderAll();
            }
        });

        // Save state on changes
        const saveState = () => {
            localStorage.setItem('bingoCards', JSON.stringify(bingoCards));
        };

        // --- Utilidades de generación de cartón ---
        function generateBingoCard() {
            // Genera un cartón tradicional argentino: 9x3, 15 números, 5 por fila, rangos por columna
            const columns = [];
            for (let c = 0; c < 9; c++) {
                let min = c === 0 ? 1 : c * 10;
                let max = c === 8 ? 90 : c * 10 + 9;
                const nums = [];
                for (let n = min; n <= max; n++) nums.push(n);
                columns.push(nums);
            }
            const grid = Array.from({length:3},()=>Array(9).fill(null));
            const usedCols = [[],[],[]];
            for (let row = 0; row < 3; row++) {
                let cols = [];
                while (cols.length < 5) {
                    let c = Math.floor(Math.random()*9);
                    if (!cols.includes(c)) cols.push(c);
                }
                usedCols[row] = cols;
            }
            const usedNumbers = new Set();
            for (let row = 0; row < 3; row++) {
                for (let col = 0; col < 9; col++) {
                    if (usedCols[row].includes(col)) {
                        let available = columns[col].filter(n=>!usedNumbers.has(n));
                        let num = available[Math.floor(Math.random()*available.length)];
                        grid[row][col] = num;
                        usedNumbers.add(num);
                    }
                }
            }
            
            // Sort numbers in each column from top to bottom, preserving empty cells
            for (let col = 0; col < 9; col++) {
                // Extract non-null numbers from this column
                const columnNumbers = [];
                const nullPositions = [];
                
                for (let row = 0; row < 3; row++) {
                    if (grid[row][col] === null) {
                        nullPositions.push(row);
                    } else {
                        columnNumbers.push(grid[row][col]);
                    }
                }
                
                // Sort the numbers in ascending order
                columnNumbers.sort((a, b) => a - b);
                
                // Reconstruct the column with sorted numbers and nulls in their original positions
                let numIndex = 0;
                for (let row = 0; row < 3; row++) {
                    if (nullPositions.includes(row)) {
                        grid[row][col] = null;
                    } else {
                        grid[row][col] = columnNumbers[numIndex++];
                    }
                }
            }
            
            return {
                numbers: grid,
                marks: Array.from({length:3},()=>Array(9).fill(false)),
                lineWin: false,
                bingoWin: false,
                lineAnnounced: false,
                bingoAnnounced: false
            };
        }

        // --- Detección de línea y bingo ---
        function checkCardEvents(card) {
            // Línea: alguna fila con todos los números marcados
            card.lineWin = false;
            for (let row = 0; row < 3; row++) {
                let complete = true;
                for (let col = 0; col < 9; col++) {
                    if (card.numbers[row][col] != null && !card.marks[row][col]) {
                        complete = false;
                        break;
                    }
                }
                if (complete) {
                    card.lineWin = true;
                    break;
                }
            }
            // Bingo: todos los números marcados
            card.bingoWin = true;
            for (let row = 0; row < 3; row++) {
                for (let col = 0; col < 9; col++) {
                    if (card.numbers[row][col] != null && !card.marks[row][col]) {
                        card.bingoWin = false;
                        break;
                    }
                }
                if (!card.bingoWin) break;
            }
        }

        // --- Renderizado principal ---
        function renderAll() {
            const bingoList = document.getElementById('bingoList');
            bingoList.innerHTML = '';
            bingoCards.forEach((card, idx) => {
                const cardDiv = document.createElement('div');
                cardDiv.className = 'bingo-card';
                cardDiv.style.marginBottom = '32px';
                cardDiv.style.position = 'relative';

                // Estado a la derecha
                const status = document.createElement('div');
                status.className = 'status';
                if (card.lineWin) {
                    const line = document.createElement('span');
                    line.className = 'line';
                    line.textContent = '¡Línea!';
                    status.appendChild(line);
                }
                if (card.bingoWin) {
                    const bingo = document.createElement('span');
                    bingo.className = 'bingo';
                    bingo.textContent = '¡Bingo!';
                    status.appendChild(bingo);
                }
                cardDiv.appendChild(status);

                // Grid
                const gridDiv = document.createElement('div');
                gridDiv.className = 'bingo-grid';
                for (let row = 0; row < 3; row++) {
                    for (let col = 0; col < 9; col++) {
                        const cell = document.createElement('div');
                        cell.className = 'bingo-cell';
                        const num = card.numbers[row][col];
                        if (num === null) {
                            cell.className += ' empty';
                        } else {
                            cell.textContent = num;
                            if (card.marks[row][col]) {
                                cell.className += ' marked';
                            }
                            cell.onclick = () => {
                                card.marks[row][col] = !card.marks[row][col];
                                checkCardEvents(card);
                                renderAll();
                                saveState();
                            };
                        }
                        gridDiv.appendChild(cell);
                    }
                }
                cardDiv.appendChild(gridDiv);
                bingoList.appendChild(cardDiv);
            });
        }

        // --- Event Handlers ---
        document.getElementById('newCardBtn').onclick = () => {
            bingoCards.push(generateBingoCard());
            renderAll();
            saveState();
        };
        document.getElementById('clearBtn').onclick = () => {
            if (bingoCards.length > 0) {
                if (confirm('¿Estás seguro de que querés borrar todos los cartones?')) {
                    bingoCards.length = 0;
                    renderAll();
                    saveState();
                }
            }
        };
        document.getElementById('themeToggle').onclick = () => {
            const toggle = document.getElementById('themeToggle');
            const label = document.getElementById('themeLabel');
            
            if (toggle.classList.contains('active')) {
                // Switch to light mode
                toggle.classList.remove('active');
                document.body.classList.remove('dark');
                label.textContent = 'Claro';
                localStorage.setItem('bingoTheme', 'light');
            } else {
                // Switch to dark mode
                toggle.classList.add('active');
                document.body.classList.add('dark');
                label.textContent = 'Oscuro';
                localStorage.setItem('bingoTheme', 'dark');
            }
        };

        // --- Inicialización ---
        (function init() {
            renderAll();
        })();
    </script>
</body>
</html>
